这是文档，不是脚本，请一行一行复制粘贴执行，不要批量自动执行

下面是Ubuntu22.04 和 centos7 的处理方法，其他系统可能需要适当调整





```shell
!/bin/bash

# ========================================================================================
#
#    Ubuntu 22.04 升级 openssh
#
# ========================================================================================

# 查看当前sshd版本号
sshd -V

# 安装openssl
apt install libssl-dev zlib1g-dev

# 切换到 临时目录
cd /tmp

# 下载最新版本openssh
wget https://mirrors.aliyun.com/pub/OpenBSD/OpenSSH/portable/openssh-9.8p1.tar.gz

# 解压文件，并进入解压目录
tar zxvf openssh-9.8p1.tar.gz 
cd openssh-9.8p1/

# 设置编译参数 - 编译 - 安装
./configure 
make -j 8
make install

# 重启 sshd服务
systemctl restart sshd

# 新开一个ssh，并验证sshd版本
sshd -V

# ========================================================================================
#
#    CentOS 7 升级 openssh ，需要先编译安装 openssl（版本至少是1.1.1）
#
# ========================================================================================

# 设置阿里云的 yum 源
curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo

# 检测新配置的 yum 源是否可用
yum makecache && yum list

# 安装编译用的工具
yum install -y wget gcc zlib zlib-devel

# 切换到 临时目录
cd /tmp

# 下载 openssl 源码包
wget https://www.openssl.org/source/openssl-1.1.1w.tar.gz

# 解压文件，并进入解压目录
tar zxvf openssl-1.1.1w.tar.gz 
cd openssl-1.1.1w

# 设置编译参数 - 编译 - 安装 openssl
./config 
make -j 8
make install

# 创建软链接，完成openssl编译安装
ln -sf /usr/local/lib64/libssl.so.1.1 /usr/lib64/libssl.so.1.1
ln -sf /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so.1.1
ln -sf /usr/local/lib64/libssl.so.1.1 /usr/lib64/libssl.so
ln -sf /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so

# 查看安装的openssl版本号，验证openssl安装成功
openssl version

# 查看当前sshd版本号
sshd -V

# 切换到 临时目录
cd /tmp

# 下载最新版本openssh
wget https://mirrors.aliyun.com/pub/OpenBSD/OpenSSH/portable/openssh-9.8p1.tar.gz

# 解压文件，并进入解压目录
tar zxvf openssh-9.8p1.tar.gz 
cd openssh-9.8p1

# 设置编译参数 - 编译 - 安装
./configure 
make -j 4
make install

# 重启 sshd服务
systemctl restart sshd

# 新开一个ssh，并验证sshd版本
sshd -V
```